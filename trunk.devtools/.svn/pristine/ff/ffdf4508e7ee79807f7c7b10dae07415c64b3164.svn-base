#!/usr/bin/env python2

u"""
  %prog [new|update] [OPTIONS]

  This program creates and updates a review request with a diff.

  The diff can either be generated by this program or generated separately and
  specified as input with the --diff (-d) option.

  The diff is by default performed against the branch's parent branch as
  defined in devhub. The parent branch can be overridden with the --parent
  (-p) option. Another alternative is to use the --unpushed (-u) option to
  perform the diff against the current branch's origin.

  For manual diffs please make sure to strip your diff from color output with
  the --no-color option and in addition make sure that you use full hash
  indexes since it's required by Review Board.

    E.g.: $ git diff master... --no-color --full-index

  Examples:
    $ %prog

    Starts a simple interactive mode for creating/updating review requests.

    $ %prog new

    Creates new review request(s). A file with default review configuration is
    created and used. ID of the new review is saved to this file.

    $ %prog new --parent <branch>

    Creates new review request(s). The diff is done against the specified
    branch. Trying to automatically detect parent branch will not be done if
    this option is supplied.

    $ %prog new -c my.reviewconfig

    Creates new review request(s). If the review configuration file specified
    by --config (-c) option exists, it is loaded. If the file does not exist,
    it is created with a default configuration. When done, ID(s) of the new
    review(s) are saved back to the file.

    $ %prog update

    Updates review request(s). The ID(s) to be used is expected to be found in
    the review configuration file saved when "%prog new" was run.

    $ %prog update -c my.reviewconfig

    Updates review request(s). The ID(s) to be used are expected to be found in
    the specified review configuration file.


Review config file:
  When starting a new review, a default review configuration file is typically
  created by the %prog tool, unless an existing file, defined by the user,
  is given as argument.

  The review configuration is a file that is read line by line. Comments and
  empty lines are ignored.

  The default review configuration is a single request for a new review which
  will include all files to be reviewed in it.

  The %prog tool is able to divide the content of the diff into several parts
  and post a review request for each part. Files in each part are included or
  excluded depending on filter(s) configured in the configuration file by the
  user.

  Syntax:

  A review definition starts on a new line. The first field on the line is
  either a number or the keyword "new". If it's a number, it's a Review Board
  ID of an existing review. Keyword "new" will create a new review request.

  The rest of the line is filter arguments that must be valid to be passed to
  the filterdiff tool. The filter arguments can be continued on the next line
  by ending the line with a '\\' character. See the examples below.

  The filters are specified as patterns to be matched against the file paths
  in the diff. Use -i for each pattern to include and -x for each pattern to
  exclude.

  Example:

    # Add all paths, then remove those matching hal/*.
    new -x hal/*
    # Add all paths matching platform/*, then remove those matching \
*README.mmd.
    12345 -i platform/* -x *README.mmd
    # A review defined using multiple rows.
    new \\
      -i hal/server/* \\
      -i hal/client/* \\
      -x *README.mmd

  The above will create two new reviews and update an existing review with
  ID 12345. After the new reviews have been posted to the Review Board,
  the %prop tool will automatically edit the configuration file to replace
  the "new" keywords with the proper review ID(s).
"""


import sys
from os.path import dirname, realpath

if sys.version_info < (2, 6):
    raise Exception("Please upgrade to python 2.6 or higher.")

sys.path.insert(0, dirname(realpath(__file__)) + "/../lib")
from review.git.main import main

main(__doc__)
